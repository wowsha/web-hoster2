<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chunked HTML Upload (RAM hosted)</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    input, button { margin-top: 1rem; }
    #link { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Upload HTML in 1â€¯MB Chunks</h1>
  <input type="file" id="file" accept=".html" />
  <br />
  <button onclick="upload()">Upload</button>
  <div id="link"></div>

  <script>
    async function upload() {
      const input = document.getElementById('file');
      const file = input.files[0];
      if (!file || !file.name.endsWith('.html')) {
        alert('Please select an .html file');
        return;
      }

      const chunkSize = 1 * 1024 * 1024; // 1 MB
      const totalChunks = Math.ceil(file.size / chunkSize);
      let slug = null;

      for (let i = 0; i < totalChunks; i++) {
        const start = i * chunkSize;
        const end = Math.min(start + chunkSize, file.size);
        const blob = file.slice(start, end);
        const content = await blob.text();

        const payload = { content, chunkIndex: i, totalChunks };
        if (slug) payload.slug = slug;

        const res = await fetch('/api/html', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        if (!res.ok) {
          document.getElementById('link').textContent = data.error || 'Upload failed';
          return;
        }
        slug = data.slug;
      }

      const url = `${window.location.origin}/api/html?slug=${slug}`;
      document.getElementById('link').innerHTML = `âœ… Uploaded!<br>ðŸ”— <a href="${url}" target="_blank">${url}</a>`;
    }
  </script>
</body>
</html>
