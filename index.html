<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload or Copy HTML</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    input, button { margin-top: 1rem; display: block; width: 100%; }
    #link { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Upload HTML (1MB Chunks) or Clone a Website</h1>
  <label>Upload a local .html file:</label>
  <input type="file" id="file" accept=".html" />

  <label>Or copy from URL:</label>
  <input type="text" id="url" placeholder="https://example.com" />

  <button onclick="upload()">Upload</button>
  <div id="link"></div>

  <script>
    async function upload() {
      const fileInput = document.getElementById("file");
      const urlInput = document.getElementById("url");
      const file = fileInput.files[0];
      const url = urlInput.value.trim();

      if (url && !file) {
        const res = await fetch("/api/html", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fromUrl: url })
        });
        const data = await res.json();
        document.getElementById("link").innerHTML = res.ok ? `âœ… Copied!<br>ðŸ”— <a href="${data.url}" target="_blank">${data.url}</a>` : data.error;
        return;
      }

      if (!file || !file.name.endsWith(".html")) {
        alert("Please select a .html file or enter a valid URL.");
        return;
      }

      const chunkSize = 1 * 1024 * 1024;
      const totalChunks = Math.ceil(file.size / chunkSize);
      let slug = null;

      for (let i = 0; i < totalChunks; i++) {
        const start = i * chunkSize;
        const end = Math.min(start + chunkSize, file.size);
        const blob = file.slice(start, end);
        const content = await blob.text();

        const payload = { content, chunkIndex: i, totalChunks };
        if (slug) payload.slug = slug;

        const res = await fetch("/api/html", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok) {
          document.getElementById("link").textContent = data.error || "Upload failed";
          return;
        }
        slug = data.slug;
      }

      const finalUrl = `${window.location.origin}/api/html?slug=${slug}`;
      document.getElementById("link").innerHTML = `âœ… Uploaded!<br>ðŸ”— <a href="${finalUrl}" target="_blank">${finalUrl}</a>`;
    }
  </script>
</body>
</html>
